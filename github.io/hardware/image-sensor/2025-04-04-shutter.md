---
layout: single
title: "[이미지센서] Shutter"
categories: hardware/image-sensor
---

- [이미지자료](https://zhuanlan.zhihu.com/p/1923011909751386861)

## Pixel Array : 픽셀(감광 소자)이 어떻게 배열 되어있는가?

![pixel array](https://picx.zhimg.com/v2-09a66f40685ec78e2cc891e4f11f1541_1440w.jpg)

- Effective Pixels : 실제 영상 영역, 출력 이미지 해상도의 크기는 Active(유효 영역)으로 결정됨
- Active Dummy : 유효 픽셀의 주변 픽셀, BPC처리 및 가장자리 픽셀 보간에 사용
- Open Dummy : Color Filter 패턴 가공 후 부하 효과를 고려하여 별도로 설정한 배하 영역(?), 이게 없으면 이미지 가장자리에 문제가 생김?

## WOI (Window of interest) : 사용자가 사용할 특정 픽셀 영역을 선택

WOI는 Active + Active Dummy 로 이루어짐

![woi](https://pic2.zhimg.com/v2-aef304b57abbdc0274db42cb9601d845_1440w.jpg)

- Vertical/Horizontal의 start/end address를 지정하여 WOI 선택

## 프레임

![frame](https://picx.zhimg.com/v2-0e66048a8ef278276611b738c3dc97a3_1440w.jpg)

- H-blank(프레임간 쉬는 시간), V-blank(라인간 쉬는 시간) : 실제 이미징에 참여하진 않지만, 신호 안정성, 데이터 동기화에 결정적 역할을 함

## Rolling Shutter

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F9939B7355AB7427A0E)

- 라인별로 노출 시간은 겹칠 수 있으나, reset & readout은 겹칠 수 없어서 위와 같은 그림이 나옴

## Shutter

![shutter](https://pic2.zhimg.com/v2-b326857b910681162f6f2985eaaa1035_1440w.jpg)

- cmos sensor는 보통 rolling shutter로 동작함
  - 한 라인 노출 시키고 읽고, 한 라인 노출 시키고 읽는 형태
- pclk : 이미지 센서 내부의 기본 클럭 신호, 1 PCLK == 1 pixel 데이터 (한 클럭 신호당 하나의 pixel 데이터를 읽음)
  - row 전체가 샘플링 되지만, PCLK는 그 결과를 serial하게 1클럭당 한 픽셀을 처리하는 단위
- line_length_pclk: 한 line에 필요한 전체 PCLK **개수**, Active width + H BLANK + LINE OB ..
- frame_length lines: 한 프레임에 포함된 라인 **개수** + 다음 프레임이 오기까지의 시간 조절, ACTIVE Height + V BLANK + F OB ...
- line_length_pclk와 frame_length_lines는 레지스터를 통해 설정함

```
frame time
frame rate = 1 / (frame*length_lines * line*length_pclk * pclk)
```

## 1H time & 1V time

![1H 1V](https://picx.zhimg.com/v2-9b85254014a9e6f0c7af68343590c6b9_1440w.jpg)

- 1H : 한 라인의 픽셀을 읽는 시간 `pclk * line_length_pclk`
- 1V : 한 프레임을 처리하는 시간 `1H * frame_length_lines == pclk * line_length_pclk * frame_length_lines`
- frame rate : `1 / 1V == 1 / (pclk * line_length_pclk * frame_length_lines)`

## CMOS 이미지 센서의 노출

![](https://pic1.zhimg.com/v2-3007da1263add2f9319e1380c4f3e358_b.jpg)

- reset : 노출 시작 전 PD와 FD(플로팅 확산 노드드를 기준 전ㅏㅂ에 복원하여 남은 전하 제거
- integration : 노출, 이때 TG는 닫아 전하가 PD 내부에 격리됨
- transfer : 전하 전송, TG를 켜면 PD의 전하가 FD로 전송되어 전압신호로 변환됨. FD의 전압은 광 강도에 비례하
- readout : FD 전압을 증폭 및 ADC를 거쳐 디지털화

## shutter 적분 시간의 구현

![](https://picx.zhimg.com/v2-3a57753892057893d4181f41a82bf903_1440w.jpg)

- coarse_integration_time : 노출시간을 조절할 라인 갯수 (큰 단위 조정)
- fine_integration_time : 노출시간을 조절한 pclk 갯수 (미세 단위 조정)
- 총 노출 PCLK 개수 : `coarse_integration_time * line_length_pclk + fine_integration_time`
- 노출 시간 : `총 노출 PCLK 개수 * 노출 시간`
- `총 노출 PCLK 개수 < line_length_pclk * frame_length_lines` 여야 함
