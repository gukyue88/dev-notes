---
layout: single
title: "[image-sensor] 노출 관련 개념 정리"
categories: hardware/image-sensor
---

#### lumen 과 lux

- lumen은 광원이 모든 방향으로 방출하는 빛의 전체 양
  - 1 루멘은 촛불 하나가 입체각으로 방출하는 빛의 양
  - 빛이 방출되는 방향이나 거리에 상관없이 광원 자체의 밝기만을 나타내는 고유한 값
  - 1000루멘 전구가 좁은 방에 있던, 넓은 운동장에 있던 총 1000 루멘의 빛을 방출하는 능력을 가짐
    - 다만, 1000루멘의 전구가 좁은 방에 있으면 좁은 공간에 집중되어 방이 밝게 느껴지지만
    - 1000루멘의 전구가 넒은 운동장에 있으면 빛이 넓은 공간으로 퍼져나가서 상대적으로 어둡게 느껴짐
    - 빛의 총량(lumen)은 변하지 않지만, 빛이 도달하는 면적에 따라 밝기(lux)가 달라짐
- lux는 단위 면적당 루멘
  - 1lux는 1루멘의 빛이 1제곱미터 면적에 균일하게 비출때 조도를 의미함
  - 같은 루멘의 광원이라도, 좁은 면적에 비추면 럭스 값은 높아지고, 넓은 면적에 비추면 럭스 값이 낮아짐

#### 1-stop : 빛의 양(lux)를 2배로 늘리거나 줄이는 개념을 쉽게 다루기 위해 만들어진 단위

> lux의 단위가 크다보니 직관성이 떨어짐. 값이 1 변할 때마다 lux 값을 2배씩 증감하도록 만든 단위

- +2 stop : lux값이 4배 증가
- +1 stop : lux값이 2배 증가
- 0 stop : lux값의 1배
- -1 stop : lux값이 2배 감소
- -2 stop : lux값이 4배 감소

#### 조리개 (aperture 또는 F-stop)

- F-stop = focal length(예. 50mm) / effective aperture(개구부의 지름)임
  - focal length에 따라 F-stop이 달라지는 이유는 굴절률 때문임
  - 초점거리가 짧은 경우(광각, 예. 24mm) 넓은 범위의 빛을 한 곳에 모으기 때문에 같은 조건에서 빛의 양이 늘어남
  - 초점거리가 긴 렌즈의 경우(망원, 예 85mm) 좁은 범위의 빛을 한 곳에 모으기 때문에 같은 조건에서 빛의 양이 줄어듬
  - 초점 거리가 2배 길어지면, 동일한 F값을 유지하기 위해 지름도 2배가 되어야함
- 1-stop과 F-stop은 같은 stop이라는 용어를 쓰지만, 1 대 1 관계가 아님.
- 1-stop을 증가(빛 2배) 시키려면, f-stop은 1 / 루트 2배가 되어야 함
- 1-stop을 감소(빛 1/2배) 시키려면, f-stop은 루트 2배가 되어야 함
- 조리개 값에 따른 EV(f2.8 기준 stop, 지름 : 50mm 기준)
  - f1.4 == 빛 4배 == +2 stop (빛 4배) == 약 35.7 mm
  - f2.0 == 빛 2배 == +1 stop (빛 2배) == 약 25 mm
  - f2.8 == 빛 1배 == 0 stop (기준 빛) == 약 17.8 mm
  - f4.0 == 빛 1/2배 == -1 (빛 1/2배) == 약 12.5 mm
  - f5.6 == 빛 1/4배 == -2 (빛 1/4배) == 약 8.9 mm
- 왜 f2.8이 기준인가? 그냥 설명을 위한 예시였을 뿐.

#### 셔터스피드 & EIT

- 셔터스피드는 기계식 셔터가 있는 카메라에서 사용되는 용어, 셔터가 열려있는 시간을 의미
- EIT는 기계식 셔터가 없는 카메라에서 사용되는 용어, 빛을 축적하는 시간을 의미

#### ISO

- 빛에 대한 민감도
- ISO 100의 의미
  - 대부분의 디지털 카메라에서 가장 낮은 감도 설정값
  - 카메라마다 ISO 100에서의 실제 빛의 양은 달라짐
  - 다만, ISO가 2배 증가하면 stop이 1증가하는건 같음

#### EV란?

- Exposure Value
- 적정 노출 (correct exposure/right exposure)을 위한 shutter speed와 aperture값의 조합을 나타내는 숫자
- 원래 의도 : 조리개와 셔터 속도 조합을 단순화 하여, 주어진 조명 조건에서 동일한 노출 결과를 얻을 수 있도록 하는 것
- 왜 ISO는 빠져있을까?
  - EV 시스템이 만들어질 떄, 사진가들이 사용하던 메인 카메라는 필름 카메라 였음
  - ISO를 변경하려면 필름 자체를 변경했어야 함.
  - 그래서 ISO는 촬영에서 고정된 값으로 간주됨
  - 기본 Exposure Value 차트의 숫자는 ISO 100 기준(고정)으로 작성됨
- 카메라에서 EV 값을 실제로 볼 수 없고, 계산을 통해 볼 수 있도록 되어 있음.
- Exposure Value 기본 공식 : `EV = log2(N*N / t)`
  - N : 조리개
  - t : 셔터스피드 (초)
  - 이 공식은 ISO 100에서의 조리개와 셔터 속도의 주어진 조합에 대한 노출값을 제공함
  - EV가 커지면, 조리개 값이 커지거나, 셔터스피드 값이 작아져야하고
  - EV가 작아지면, 조리개 값이 작아지거나, 셔터스피드 값이 커져야 함
  - EV는 stop과 같이 1의 증감에 따라 2의 배수로 증감하도록 설계됨(log2 사용)
- [Exposure Value chart](####Exposure-Value-Chart)
  - 상황별 EV 값
    - EV 0 : 보름달 달빛 아래 야간 사진
    - EV 4 : 실내 조명이나 어두운 야외 조건에 적합
    - EV 8 : 창문 조명이 있는 실내 장면이나 일몰 중의 야외 장면
    - EV 12 : 흐린날 또는 화창한날 그늘
    - EV 15 : 밝은 태양광
  - 만약, EV 15 환경에서 ISO 100 + 셔터스피드 1/125s를 사용한다면 f를 16으로 맞춰야 함.
    - 이것을 sunny 16 규칙이라 함
  - 이 차트는 ISO 100을 기준(고정)으로 작성됨

#### EV 중간 정리

- EV는 적정 노출을 위한 shutter speed와 aperture 값의 조합으로 만들어진 숫자
  - 특정 조명 조건에서의 적정노출을 얻기 위한 shutter speed와 aperture를 계산하기 위해 만들어짐
- Exposure Value와 실제 Exposure량은 **반비례 관계**임.
  - Exposure Value가 +1stop이 되면, 실제 Exposure량은 -1stop이 되도록 설계됨
  - 다시 말해, Exposure Value가 높으면, 실제 노출량을 줄이는 방향으로 f-stop, shutter speed가 반응하도록 설계됨

#### lux + ISO와 EV의 관계

- `N * N / t == E * S / C`
  - N : 조리개
  - t : 셔터스피드
  - E : lux (루멘/m제곱)
  - S : ISO
  - C : 입사광계 교정 상수 (보통 250 또는 340을 사용)
- `EV == log2(N * N / t) == log2(E * S / C)`
  - lux to EV
    - 노출계가 있는 카메라(DSLR 카메라의 경우 노출계가 따로 위치함 또는 조도센서 활용)의 노출계로 lux를 측정하고 이에 `ISO / C`를 곱하고 `log2`를 취해 EV로 변환함
    - CMOS 센서의 경우, 센서가 노출계의 역할을 겸하게 됨 == CMOS 센서 자체가 빛의 양을 측정하는 노출계 역할을 겸하게 됨

### EV와 lux의 형식적인 관계의 한계

- lux는 피사체에 반사되는 빛(반사광)이 아닌 입사광(피사체에 입사되는 빛) 기준임
- 이걸 사실 제대로 재려면 카메라가 아니라 반구형 확산 돔을 통해 180도 전방위에서 들어오는 빛을 모두 모아 측정해야함 (조도계)
- 조도계가 따로 있는 경우, 피사체에 입사되는 빛과 조도계에서 측정되는 빛이 다를 수 있음
- CMOS 센서의 경우, 입사광이 아닌 피사체의 반사광을 측정하므로 실제 EV와 카메라가 추정한 EV가 다를 수 있음(예. 어두운 밤하늘(반사광이 없어 EV가 낮게 측정), 하얀 눈밭(반사광이 많아 EV가 높게 측정) 등)

### EV의 2가지 의미

- 환경의 밝기 (절대 EV) : lux를 기반으로 적정노출을 만들기위한 조리개, EIT, ISO를 계산하기 위해 만든 개념
- 노출 보정 (상대 EV) : 카메라가 찾은 적정 노출값(EV)을 기준으로, 사용자가 사진의 밝기를 의도적으로 조절하는 기능
  - 카메라는 빛의 양을 평균적으로 측정해 적정 노출을 찾아내는데, 하얀 눈밭의 경우 반사광이 많아 EV가 높다고 판단해 노출을 낮추고, 어두운 밤하늘의 경우 반사광이 적어 EV가 낮다고 판댄해 노출을 높임. 이런 경우 사진이 의도와 다르게 나와 노출 보정을 사용함.
  - 하얀 눈밭의 경우, 카메라가 낮춘 노출을 다시 올리기 위해 EV +1.0 같이 노출 보정(t상대 EV)를 높여 찍고, 어두운 밤하늘의 경우, 카메라가 높인 노출을 다시 낮추기 위해 EV -1.0 같이 노출 보정(상대 EV)를 낮춤

#### Exposure-Value-Chart

|       | f1.0 | f1.4 | f2.0 | f2.8 | f4.0 |
| ----- | ---- | ---- | ---- | ---- | ---- |
| EV -2 | 4s   | 8s   | 16s  | 32s  | 64s  |
| EV -1 | 2s   | 4s   | 8s   | 16s  | 32s  |
| EV 0  | 1s   | 2s   | 4s   | 8s   | 16s  |
| EV +1 | 1/2s | 1s   | 2s   | 4s   | 8s   |
| EV +2 | 1/4s | 1/2s | 1s   | 2s   | 4s   |

#### Auto Exposure

- `EV == log2(N * N / t) == log2(E * S / C)`
  - 위에서 주어진 식은 E(lux)와 N(f-stop), t(shutter speed), S(ISO)가 선형적임
  - 이론적으로 완벽한 노출(Target Y == 18% gray)를 달성하기 위한 N, t, S의 조합을 알려줌
- 하지만, 실제 카메라 AE 시스템은 이 값만을 따르지 않음
  - 이유1. 장면의 오해석 : 하얀눈, 검은옷을 회색으로 만들 수 있음
  - 이유2. 노출 분배의 비선형성 : N, t, S를 어떻게 분배해야하는지는 알려주지 않음
- 현대의 카메라 시스템은 단순히 노출 공식의 결과를 따르지 않고, targetY를 설정하는 매핑 곡선을 통해 최종 노출을 결정함
  - 1. Lux -> TargetY (노출전략) : 매핑 곡선은 lux(또는 추정된 EV)에 따라 궁극적으로 목표해야할 targetY를 정의함
    - 이는 제조사의 의도된 노출 전략(예. AE 시스템이 현재 환경이 밝으므로 EV 공식이 요구하는 값보다 조금 더 밝게 targetY를 찍어야 사용자가 만족한다)을 반영함
  - 2. TargetY -> 노출 파라미터 분배 : targetY를 달성하기 위한 총 gain을 계산하고, 이를 N, t, S에 배분
    - 움직이는 피사체의 경우 shutter speed를 높이는 대신 ISO를 희생함
    - 심도를 중요시 하는 모드의 경우 조리개를 고정하고, 나머지 두 요소를 조정함
