---
layout: single
title: "[JS] 실행 컨텍스트"
categories: web/javascript
published: false
---

#### 핵심 요약

> 자바스크립트는 코드를 실행하는데 필요한 정보(각 변수의 값이 무엇인지, this가 무엇인지)를 '실행 컨텍스트'라는 공간에 담아 관리함.

#### 소스코드의 평가와 실행

- 자립스크립트는 "코드 평가"와 "코드 실행" 2 단계로 나누어 처리됨.
- 코드 평가 : 단순히 코드를 읽는 과정으로 이때 해당 코드에 대한 실행 컨텍스트가 생성됨.
- 코드 실행 : 실행 컨텍스트의 정보를 읽거나 업데이트 하면서 코드를 실행함.

```js
console.log(a);
var a = 5;
console.log(a);
```

- 코드 평가 단계
  - a 변수에 undefined를 할당하여 실행 컨텍스트에 넣어 놓음.
- 코드 실행 단계
- 처음 `console.log(a);`를 만나면, 실행 컨텍스트 안의 변수 a 값인 `undefined`가 출력 됨
- `var a = 5;`를 만나면, 실행 컨텍스트 안의 변수 a 값을 `5`로 변경함.
- 다음 `console.log(a);`를 만나면, 실행 컨텍스트 안의 변수 a 값인 `5`를 출력하게 됨

#### 호이스팅과 let/const + TDZ

변수나 함수 선언이 스코프 위로 끌어 올려지는 것처럼 동작하는 현상

- javascript 말고 다른 언어의 경우, 위와 같은 예제처럼 a가 선언되어있지 않은 상태에서 a를 접근하려고 하면 에러가 발생함.
- javascript에서는 코드 평가 단계에서 a가 `undefined`로 정의되기 때문에 에러가 발생하지 않음.

> 초기 javascript 설계시 유연성과 빠른 스크립트 실행을 위해 호이스팅 개념이 적용되었지만, 현대적인 관점에서는 오히려 불편하고 혼란을 주게 됨

let, const 개념이 도입됨

- let, const로 선언된 변수의 경우, 호이스팅은 똑같이 되지만 초기화 없이 접근하면 에러를 발생시킴
- 초기화가 되기 전까지의 구간을 TDZ (Temporal Dead Zone)이라고 함

#### 실행컨텍스트 종류

코드 타입에 따라 생성되는 실행컨텍스트 종류가 달라짐

- 전역 코드 > 전역 실행 컨텍스트 생성 : 전역 변수 및 전역 함수를 관리
- 함수 코드 > 함수 실행 컨텍스트 생성 : 지역 변수, 매개변수, arguments 객체 관리
- 모듈 코드 > 모듈 실행 컨텍스트 생성 : 해당 모듈의 독립적인 스코프를 가짐
  - 예전에 js는 하나의 덩어리였지만, 사이즈가 커지면서 개발이 어려워짐
  - js를 여러 모듈로 나누어 개발할 수 있게 만듦
  - 모듈의 주요 기능 중 하나는 각 모듈간 변수명, 함수명 충돌 피하는 것임
  - 이를 위해 전역 실행 컨텍스트와 독립적인 모듈 실행 컨텍스트를 따로 만들게 됨
- eval 코드와 eval 실행 컨텍스트도 있지만, 사용하지 않는걸 권장하므로 생략

#### 실행컨텍스트 스택

현재 실행중인 실행컨텍스트들을 모아 놓는 곳

```js
const x = 1;
const y = 2;

function foo() {
  const x = 10;
  const y = 20;
  console.log(x + y);
}

foo();
console.log(x + y);
```

코드 평가 및 실행 순서

- 코드 평가 및 실행 전
  - 실행컨텍스트 스택 상태 : (비어있음)
- 전역 코드 평가 & 전역 실행 컨텍스트 생성
- 생성된 전역 실행 컨텍스트를 실행 컨텍스트 스택에 쌓아놓음
  - 실행컨텍스트 스택 상태 : 전역 실행 컨텍스트
- 전역 코드 실행
- 실행 중 foo() 를 만나게 됨
- foo() 코드 평가 & foo() 함수 실행 컨텍스트 생성
- 생성된 foo() 함수 실행 컨텍스트를 실행 컨텍스트 스택에 쌓아놓음
  - 실행컨텍스트 스택 상태 : foo() 함수 실행 컨텍스트 + 전역 실행 컨텍스트
- foo() 함수 실행 & 완료
- foo() 함수 실행 컨텍스트를 실행 컨텍스트 스택에서 제거
  - 실행컨텍스트 스택 상태 : 전역 실행 컨텍스트
- 전역 코드 실행 완료
- 전역 실행 컨텍스트를 실행 컨텍스트 스택에서 제거
  - 실행컨텍스트 스택 상태 : (비어있음)

#### 렉시컬 환경
