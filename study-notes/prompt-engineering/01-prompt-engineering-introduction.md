# Prompt Engineering Introduction

참고 자료 : [Prompt Engineering Guide](promptingguide.ai/kr)

- 프롬프트 엔지니어링 : 프롬프트를 개발하고 최적하여 llm의 역량을 향상시키는 엔지니어링

## 0. 모델의 동작의 이해

```
# input
하늘은

# output
푸른
색
입니다
.
```

- input의 다음 토큰을 예상하여 반복하는 형태임

## 1. LLM 관련 파라미터

#### temperature & top_p

- 값이 낮을 수록 높은 확률의 토큰이 나오고, 값이 높을 수록 토큰의 무작위성이 증가함
- 사실을 기반으로 하는 질의응답 같은 작업에는 낮게 세팅
- 창의적인 작업의 경우 높게 세팅함
- 작동 방식의 차이
  - temperature : 각 토큰의 확률 차이를 넓히거나(높은건 더 높게, 낮은건 더 낮게) 좁혀서 제어함
  - top_p : 상위 x% 의 토큰만 후보군으로 사용

> 권장사항 : 둘 중 하나만 변경

#### max Length

- 모델이 생성하는 토큰의 수 관리
- 답변이 너무 길거나, 관련 없는 응답을 방지하고 비용을 관리하는데 도움이 됨

#### stop sequences

- 모델의 토큰 생성을 중지하는 문자열
- stop sequences를 지정하면 모델의 응답 길이 및 구조를 제어하는데 도움이 됨
- 예) stop sequences = "11" 이라면, 항목이 10개를 초과하지 않는 리스트를 생성하도록 모델에 지시 가능

#### Frequency Penalty & Presence Penalty

- 반복되는 토큰에 패널티를 적용하여, 토큰이 다시 등장할 가능성을 줄임
- 사실 기반으로 하는 질의 응답의 경우, 모델의 집중력을 위해 낮은 penalty를 사용
- 창의적인 작업의 경우, 다양성 및 창의성을 위해 높은 penalty를 사용
- 작동 방식의 차이
  - frequency penalty : 등장한 빈도에 비례하여 패널티를 적용
  - presence penalty : 빈도에 상관없이 동일한 패널티를 적용

> 권장사항 : 둘 중 하나만 변경하거나, 둘 다 변경하지 않기

## 2. 프롬프트 기초 및 형식

- 모델에게 전달하는 프롬프트에 '지시', '질문', '맥락', '입력', '예시' 등 다른 세부사항을 포함하면 더 나은 결과를 얻을 수 있음
- 일반 질문

#### 일반 질문 형식

```
<질문>?
```

#### 일반 지시

```
<지시>
```

#### QA 형식 (많은 QA 데이터 세트에서 표준 형식으로 사용함)

```
Q: <질문>?
A:
```

- 이것은 Zero-shot prompting (예제가 없이 직접 모델에 응답하는 프롬프트 형식)

#### few-shot prompting

```
<질문>?
<답변>
<질문>?
<답변>
<질문>?
<답변>
<질문>?
```

#### 꼭 QA 태스크를 따라야 하는 건 아님

```
# human
멋지다! // 긍정
나빠! // 부정
그 영화는 굉장했어! // 긍정
이 얼마나 끔찍한 공연인가! //

# AI
부정
```

#### 개인 생각

- llm의 동작 방식이 입력에 대한 다음 토큰을 내는 것이니, llm에게 답변을 이어가게 하는 형식을 취하는 것 같음
- 또 많은 QA 데이터 세트에서 위처럼 학습을 했으니, QA 형식을 유지하면 llm이 답변하기 수월할듯

## 3. 프롬프트의 구성 요소

- 지시(instruction) : 모델이 수행할 특정 작업 또는 지시
- 문맥(context) : 더 나은 응답을 위해 모델을 조정할 수 있는 외부 정보나 추가 정보
- 입력 데이터(input data) : 응답받고자 하는 입력이나 질문
- 출력 지시자(output indicator) : 출력의 유형이나 형식

> 위 네가지 구성 요소가 모두 필요한 것은 아니며, 형식은 어떤 작업인지에 따라 달라질 수 있음

## 4. 프롬프트 설계에 관한 일반적인 팁

#### 시작은 간단하게

> 프롬프트 설계가 최적의 결과를 얻기 위해서는 많은 실험이 필요한 반복적인 과정이 필요함!

- 간단한 프롬프트로 시작하여 더 나은 결과를 위한 요소나 문맥을 계속해서 추가
- 프롬프트의 버전 관리가 중요함
- 여러 하위 작업을 포함한 큰 단위 작업을 실행해야 하는 경우, 작업을 보다 작은 단위로 세분화
- 프롬프트 설계 초기 과정에서 너무 많은 복잡성이 추가되는 것을 방지

#### 지시(instruction)

- 달성하고자하는 명령어를 사용하여 모델에게 지시함
  - 예) '작성하기', '분류하기', '요약하기', '번역하기', '정렬하기' 등
- 프롬프트의 시작 부분에 지시 사항을 명시하는 것이 좋다는 의견도 있음
- '###'과 같이 명확한 구분 기호를 사용하여 명령어와 지시 사항을 구분하면 좋음

```
### 지시 ###
다음 텍스트를 스페인어로 변역해 줘.
텍스트 : "안녕하세요!"
```

#### 특이성

- 모델에 싫행시킬 지시와 작업을 구체적으로 설명하자
- 좋은 형식과 상세한 프롬프트를 준비하는 것이 중요함
- 단, 프롬프트의 길이 제한이 있기 떄문에 이점을 염두해 두어야 함
- 불필요한 내용을 제외하고, 관련성이 높고 답변에 도움이 될 세부사항을 넣어줘야함

#### 부정확성 피하기

- 프롬프트는 구체적이고 직접적적술수록 메시지가 더 효과적으로 전달됨
- `프롬프트 엔지니어링의 개념을 설명해 줘. 설명은 너무 자세히는 하지 말아줘.` (x)
- `고등학생에게 프롬프트 엔지니어링 개념을 2~3개의 문장으로 설명해줘.`

#### 해야 하는 것과 하지 말아야 할 것

- '하지 말아야 할 것' 보다는 '해야 하는 것'에 초점을 두자
- 이렇게 하면 보다 구체적이고 모델로 부터 좋은 답변을 이끌어 내는 세부 사항에 집중할 수 있음

하지 말아야 할 것에 초점을 두어 영화 추천 챗봇이 실패한 예시

```
다음은 고객에게 영화를 추천하는 상담원입니다. 고객의 관심사와 개인정보를 물어보면 안됩니다.
고객: 제 관심사를 바탕으로 영화를 추천해 주세요
상담원:
```

- output에서 '어떤 종류의 영화를 좋아하세요?' 라고 관심사를 묻는 답변을 얻음

개선된 프롬프트

```
다음은 고객에게 영화를 추천하는 상담원입니다. 상담원은 글로벌 인기 영화 중에서 영화를 추천해야 합니다. 사용자의 관심사와 개인정보를 물어보면 안됩니다. 상담원이 추천할 영화가 없는 경우 "죄송합니다. 오늘 추천할 영화를 찾을 수 없습니다."라고 응답해야 합니다.
고객: 제 관심사를 바탕으로 영화를 추천해 주세요.
상담원:
```

- output에서 '당신에 관심사에 관한 정보를 알 수 없습니다. 다만 지금 가장 인기 있는 영화에 대한 목록이 있습니다...' 처럼 답함

## 5. 프롬프트 예시

프롬프트를 사용한 다양한 작업 예시

#### 문장 요약 작업

- 문장 요약은 자연어 생성의 대표적인 작업 중 하나임
- 언어 모델의 가장 유망한 애플리케이션 중 하나는 기사와 개념을 빠르고 읽기 쉽게 요약할 수 있는 능력임

```
<문장예시>
위 내용을 한 문장으로 요약해 줘:
```

#### 정보 추출 작업

- 언어 모델은 다양한 자연어 처리(NLP)작업을 수행할 수 있음

```
<내용>
위 내용에서 언급한 llm 기반 제품을 알려줘.
```

#### 질의 응답 작업

- 모델로 부터 좋은 답변을 얻는 좋은 방법 중 하나는 프롬프트 형식을 개선하느 것임
- 지시, 문맥, 입력데이터, 출력지시자를 조합혀여 더 나은 결과를 얻자

```
아래 문맥을 고려해서 질문에 답변해 줘. 답변은 짧고 간결하게 해 줘. 답변이 정확하지 않다면, '확실하지  않은 대답' 이라고 응답해 줘.
문맥: <OKT3 관련 내용 문맥>
질문: OKT3는 어디서 유래했는가?
답변:
```

#### 텍스트 분류 작업

- '입력 데이터'나 '예시' 활용

```
문장을 neutral, 부정 혹은 긍정으로 분류해 줘.
문구: 그 음식은 그럭저럭이었어.
감정:
```

- 여기서 답변이 대문자로 시작한 'Neutral'이 나옴
- 소문자로 된 'neutral'을 원한다면 예시를 추가

```
문장을 neutral, 부정 혹은 긍정으로 분류해 줘.
문구: 이번 휴가는 그럭저럭이었어.
감정: neutral
문구: 그 음식은 그럭저럭이었어.
감정:
```

- 소문자로 된 'neutral'로 잘 나옴

#### 대화 작업

- llm 시스템의 행동과 의도 그리고 정체성을 고려하여 지시를 내려야 함(?)

예) 주어진 질문에 기술적이고 과학적인 대답을 반환할 수 있는 대화형 시스템 구축 (역할 프롬프팅)

```
다음은 AI 연구 보조원과의 대화입니다. 이 보조원의 어조는 기술적이고 과학적입니다.
인간: 안녕, 너는 누구니?
AI: 반갑습니다! 저는 AI 연구 보조원입니다. 오늘은 무엇을 도와드릴까요?
인간: 블랙홀 생성에 대해 설명해 줄래?
AI:
```

- 위 처럼 했을 때 너무 기술적인 대답을 함
- 좀더 접근하기 쉬운 답변으로 지시해본다면?

```
다음은 AI 연구 보조원과의 대화입니다. 보조원은 초등학생도 이해할 수 있은 수준으로 답변해야 합니다.
인간: 안녕, 너는 누구니?
AI: 반갑습니다! 저는 AI 연구 보조원입니다. 오늘은 무엇을 도와드릴까요?
인간: 블랙홀 생성에 대해 설명해줄래?
AI:
```

- 이렇게 하면 좀 더 쉬운 답변을 얻을 수 있음

#### 코드 생성 작업

```
/*
유저의 이름을 입력받고 "안녕"이라고 해 줘
*/
```

- 프로그래밍 언어를 지정하지 않아도 짜주긴 함

```
"""
DB테이블 departments, columns = [DepartmentId, DepartmentName]
DB테이블 students, columns = [DepartmentId, StudentId, StudentName]
컴퓨터과학부에 속한 모든 학생에 대한 MySQL 쿼리를 작성해 줘
"""
```

- 더 자세히 프롬프트를 디잔인하면 더 강력한 코드 생성이 가능함

#### 추론 작업

- 추론이 필요한 작업은 llm이 하기 **가장 어려운 작업**에 속함
- 수학적인 능력을 필요하는 작업은 잘하지만, 추론 작업을 수행하는데는 어려움이 있기 떄문에 더 향상된 프롬프트 엔지니어링 기술이 필요함
- 고급 기술에 대해서는 이후에 살펴보고, 여기에서는 산술 능력을 살펴보자
- `9000 * 9000 은 뭐야?` -> 잘 대답함
- `주어진 수 중에서 홀수를 모두 더해서 짝수를 만들어줘: 15, 32, 5, 13, 82, 7, 1` -> 답변 틀림 : 주어진 수의 합을 모두 더해버림
- 개선해서 `{위 내용} 문제를 단계별로 해결해 봐. 먼저 주어진 수 중 홀수를 찾아낸 뒤, 그것들을 합해서 결과가 홀수인지 짝수인지 판별해줘` -> 답변 맞음, 홀수만 찾아서 계산해냄. (여러번 시도시 가끔 오답을 제시하기도 함)

> 모든 작업의 성능을 향상시키기 위해 보다 심화된 프롬프트 엔지니어링의 개념과 기법에 대해 배우자!
